<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Incident Reporting | DangerAlert</title>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins&display=swap');
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #ff4d4d, #F5F5F5);
      color: white;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    nav {
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(255, 255, 255, 0.1);
      padding: 15px 40px;
      position: fixed;
      top: 0;
      left: 0;
      backdrop-filter: blur(12px);
      z-index: 1000;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }
    nav h1 {
      font-size: 1.8em;
      margin: 0;
    }
    nav h1::after { content: '‚ú®'; margin-left: 10px; }
    .profile { display: flex; align-items: center; gap: 15px; }
    .profile span { font-weight: 600; }
    nav a {
      color: #fff; text-decoration: none; margin-left: 20px;
      padding: 8px 18px; border: 1px solid #fff; border-radius: 25px;
      transition: background 0.3s, transform 0.2s; font-weight: 600;
      display: flex; align-items: center;
    }
    nav a i { margin-right: 8px; }
    nav a:hover { background: #fff; color: #4b0082; transform: translateY(-2px); }

    .sidebar {
      width: 250px; background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.05));
      height: calc(100vh); padding-top: 80px; position: fixed; top: 0; left: 0;
      display: flex; flex-direction: column; align-items: center;
      box-shadow: 2px 0 15px rgba(0,0,0,0.2); backdrop-filter: blur(8px);
      overflow-y: auto;
    }
    .sidebar::-webkit-scrollbar { width: 6px; }
    .sidebar::-webkit-scrollbar-thumb { background-color: rgba(255,255,255,0.4); border-radius: 3px; }
    .sidebar a.sidebar-btn {
      display: flex; align-items: center; justify-content: flex-start;
      width: 80%; padding: 15px; margin: 8px 0; border-radius: 12px;
      background: rgba(255,255,255,0.1); color: #fff; text-decoration: none;
      transition: all 0.3s ease;
    }
    .sidebar a.sidebar-btn:hover, .sidebar a.sidebar-btn.active {
      background: rgba(255,255,255,0.3);
      box-shadow: 0 0 10px #fff inset, 0 0 20px #fff;
      transform: translateY(-2px);
    }
    .sidebar a.sidebar-btn i { margin-right: 12px; min-width: 20px; text-align: center; }

    .content {
      margin-left: 250px;
      padding: 120px 40px;
      flex-grow: 1;
      overflow-y: auto;
    }
    .card {
      background: rgba(255,255,255,0.2);
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      margin-bottom: 20px;
      transition: all 0.3s ease;
      border: 2px solid transparent;
      color: white;
    }
    .card:hover {
      transform: scale(1.02);
      box-shadow: 0 8px 20px rgba(0,0,0,0.4);
      background: rgba(255,255,255,0.3);
      border: 2px solid #fff;
    }
    .form-control, .form-select {
      background: rgba(255,255,255,0.8);
      border: none;
      border-radius: 12px;
      color: #000;
    }
    .btn-danger {
      background-color: #ff4d4d;
      border: none;
      border-radius: 25px;
      font-weight: 600;
    }
    .btn-danger:hover {
      background-color: #fff;
      color: #4b0082;
      transform: translateY(-2px);
    }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav>
    <h1>üõ°Ô∏è Safe Connect</h1>
    <div class="profile">
      <span>üëã Welcome, gxekiwe48</span>
      <a href="/logout"><i class="fas fa-door-open"></i> Logout</a>
    </div>
  </nav>

  <!-- Sidebar -->
  <div class="sidebar">
    <a href="/dashboard" class="sidebar-btn"><i class="fas fa-home"></i> Dashboard</a>
    <a href="/safety-map" class="sidebar-btn"><i class="fas fa-map"></i> Safety Map</a>
    <a href="/community" class="sidebar-btn"><i class="fas fa-comments"></i> Community Forum</a>
    <a href="/emergency_alert" class="sidebar-btn"><i class="fas fa-bolt"></i> Emergency Alert</a>
    <a href="/incident_reporting" class="sidebar-btn"><i class="fas fa-edit"></i> Incident Reporting</a>
    <a href="/safety_resources" class="sidebar-btn"><i class="fas fa-book"></i> Safety Resources</a>
  </div>

  <!-- Content -->
  <div class="content">
    <div class="card">
      <h2><i class="fas fa-file-alt"></i> Report an Incident</h2>
      <p>Use this form to report a safety or criminal incident. You can also attach a short audio recording as evidence.</p>

      <form id="incidentForm" enctype="multipart/form-data">
        <div class="mb-3">
          <label for="incidentType" class="form-label">Incident Type</label>
          <select id="incidentType" class="form-select" required>
            <option value="">Select type...</option>
            <option value="Gender-Based Violence">Gender-Based Violence</option>
            <option value="Rape">Rape</option>
            <option value="Robbery">Robbery</option>
            <option value="Assault">Assault</option>
            <option value="Other">Other</option>
          </select>
        </div>

        <div class="mb-3">
          <label for="incidentDescription" class="form-label">Description</label>
          <textarea id="incidentDescription" class="form-control" rows="4" placeholder="Describe what happened..." required></textarea>
        </div>

        <button type="submit" class="btn btn-danger w-100">
          <i class="fas fa-paper-plane"></i> Submit Report
        </button>
      </form>

      <div id="reportStatus" class="mt-3 text-center"></div>
    </div>
  </div>

  <script>
    const form = document.getElementById('incidentForm');
    const statusBox = document.getElementById('reportStatus');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const incidentType = document.getElementById('incidentType').value;
      const description = document.getElementById('incidentDescription').value;
      const username = "{{ username }}";

      const location = await getUserLocation();

      const data = {
        username,
        incident_type: incidentType,
        description,
        location
      };

      const res = await fetch('/api/report_incident', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      const result = await res.json();

      // ‚úÖ Display result message
      statusBox.innerHTML = `<div class="alert alert-${result.status === 'success' ? 'success' : 'danger'}">${result.message}</div>`;

      // ‚úÖ Clear form fields if successful
      if (result.status === 'success') {
        form.reset();
      }
    });

    function getUserLocation() {
      return new Promise((resolve) => {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(pos => {
            resolve(`${pos.coords.latitude},${pos.coords.longitude}`);
          }, () => resolve("Unknown"));
        } else {
          resolve("Unknown");
        }
      });
    }
  </script>

</body>
</html>
